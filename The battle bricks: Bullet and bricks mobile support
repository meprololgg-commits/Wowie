local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local UserInputService = game:GetService("UserInputService")
local player = Players.LocalPlayer 
local char = player.Character or player.CharacterAdded:Wait()
if not player then return end

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "UI"
screenGui.ResetOnSpawn = true
screenGui.Parent = player.PlayerGui

local plrteam = player.Team
if not plrteam then
	print("NO!")
end

local Button = Instance.new("TextButton")
Button.Name = "Button"
Button.Parent = screenGui
Button.Text = "Ability"
Button.Size = UDim2.new(0.094, 0, 0.147, 0)
Button.Position = UDim2.new(0.877, 0, 0.549, 0) 
Button.BackgroundColor3 = Color3.fromRGB(48, 48, 48)
Button.TextColor3 = Color3.fromRGB(255, 255, 255)
Button.Font = Enum.Font.SourceSansBold
Button.TextSize = 24
Button.BorderSizePixel = 0
Button.AutoButtonColor = true
Button.BackgroundTransparency = 0.5

local ConerUi = Instance.new("UICorner")
ConerUi.Parent = Button

local isHolding = false
local TARGETING_RANGE = 100


local function findClosestEnemy()
	local closestEnemy = nil
	local closestDistance = TARGETING_RANGE

	for _, targetPlayer in pairs(Players:GetPlayers()) do
		if targetPlayer == player then continue end

		local targetChar = targetPlayer.Character
		if not targetChar then continue end

		local targetHumanoidRootPart = targetChar:FindFirstChild("HumanoidRootPart")
		if not targetHumanoidRootPart then continue end

		local charHumanoidRootPart = char:FindFirstChild("HumanoidRootPart")
		if not charHumanoidRootPart then continue end
		if targetPlayer.Team == player.Team then continue end
		local distance = (targetHumanoidRootPart.Position - charHumanoidRootPart.Position).Magnitude
		
		if distance < closestDistance then
			closestDistance = distance
			closestEnemy = targetPlayer
		end
	end

	return closestEnemy
end

local function fireAbility()
	print("OK!")
	local tool = char:FindFirstChildOfClass("Tool")
	if tool then
		local RemoteEvent = tool:FindFirstChildOfClass("RemoteEvent")
		if tool.Name == "BarbaricTool" then
			if RemoteEvent then
				RemoteEvent:FireServer("Charge")
			end
		elseif tool.Name == "SpartanTool" then
			if RemoteEvent then
				RemoteEvent:FireServer("Kick")
			end
		elseif tool.Name == "StunnerTool" then
			local enemy = findClosestEnemy()
			if enemy then
				local enemyChar = enemy.Character
				if enemyChar then
					local targetPos = enemyChar:FindFirstChild("HumanoidRootPart").Position
					if RemoteEvent then
						RemoteEvent:FireServer("Shoot", targetPos)
					end
				end
			else
				print("No enemy in range!")
			end
		end
	end
end

Button.MouseButton1Down:Connect(function()
	isHolding = true
	while isHolding do
		fireAbility()
		task.wait(0.1) 
	end
end)

Button.MouseButton1Up:Connect(function()
	isHolding = false
end)

while true do
	wait(0.08)
	local tool = char:FindFirstChildOfClass("Tool")
	if tool then
		if tool.Name == "BarbaricTool" then
			Button.Text = "Charge"
		elseif tool.Name == "SpartanTool" then
			Button.Text = "Kick"
		elseif tool.Name == "StunnerTool" then
			Button.Text = "Fire"
		else
			Button.Text = "Ability"
		end
	else
		Button.Text = "None"
	end
end
